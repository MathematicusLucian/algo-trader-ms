FROM python:3.8.18 as python-base
# FROM --platform=linux/amd64 python:3.8.18
ENV PYTHONUNBUFFERED 1
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app
COPY . /usr/src/app/
RUN chmod 777 /usr/src/app 
RUN chmod 777 /usr/src/app/entrypoint.sh
RUN pip install --upgrade pip
RUN pip install markupsafe
RUN pip install 'nodejs-bin[cmd]'
RUN pip install botasaurus
RUN pip install --no-cache-dir -r requirements.txt
# RUN apt -f install -y
# RUN apt-get install build-essentials
# RUN apt-get install -y wget
# RUN apt-get install apt-utils
# RUN apt-get update && apt-get install -y \
#     fonts-liberation \
#     libasound2>=1.0.17 \
#     libatk-bridge2.0-0>=2.5.3 \
#     libatk1.0-0>=2.2.0 \
#     libatspi2.0-0>=2.9.90  \
#     libc6>=2.17 \
#     libcairo2>=1.6.0 \
#     libcups2>=1.6.0 \
#     libcurl3-gnutls \
#     libcurl3-nss \
#     libcurl4 \
#     libdbus-1-3>=1.9.14 \
#     libdrm2 \
#     libexpat1>=2.1~beta3 \
#     libgbm1>=17.1.0~rc2 \
#     libglib2.0-0>=2.39.4 \
#     libgtk-3-0>=3.9.10 \
#     libgtk-4-1 \
#     libnspr4>=2:4.9-2~ \
#     libnss3>=2:3.35 \
#     libpango-1.0-0>=1.14.0 \
#     libvulkan1 \
#     libwayland-client0 \
#     libx11-6>=2:1.4.99.1 \
#     libxcb1>=1.9.2 \
#     libxcomposite1>=1:0.4.4-1 \
#     libxdamage1>=1:1.1 \
#     libxext6 \
#     libxfixes3 \
#     libxkbcommon0>=0.5.0 \
#     libxrandr2 \
#     xdg-utils \
#     libu2f-udev
# RUN wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
# RUN apt-get install ./google-chrome-stable_current_amd64.deb -y --fix-missing
# RUN dpkg -i ./google-chrome-stable_current_amd64.deb
# RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
# RUN echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list
# RUN apt-get update && apt-get install -y google-chrome-stable
# RUN rm google-chrome-stable_current_amd64.deb
# RUN echo "Chrome: " && google-chrome --version
COPY ./uwsgi.ini /etc/uwsgi.ini
EXPOSE 5000
CMD ["./entrypoint.sh"]